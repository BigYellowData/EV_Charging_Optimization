services:
  # Synthetic mode optimizer
  optimizer-synthetic:
    build: .
    image: ev-optimizer:latest
    container_name: ev-optimizer-synthetic
    command: ["--vehicles", "30", "--horizon", "24"]
    volumes:
      - ./data_cache:/app/data_cache
      - ./results:/app/results
      - ./logs:/app/logs
    environment:
      - LOG_LEVEL=INFO
    profiles: [dev, all]
  
  # Real data mode optimizer
  optimizer-real:
    build: .
    image: ev-optimizer:latest
    container_name: ev-optimizer-real
    command: ["--real-data", "--site", "caltech", "--limit", "30"]
    env_file:
      - .env
    volumes:
      - ./data_cache:/app/data_cache
      - ./results:/app/results
      - ./logs:/app/logs
    environment:
      - LOG_LEVEL=INFO
    profiles: [prod, all]
  
  # Development mode with verbose logging
  optimizer-dev:
    build: .
    image: ev-optimizer:latest
    container_name: ev-optimizer-dev
    command: ["--verbose", "--vehicles", "10"]
    volumes:
      - ./src:/app/src  # Mount source for development
      - ./data_cache:/app/data_cache
      - ./results:/app/results
      - ./logs:/app/logs
    environment:
      - LOG_LEVEL=DEBUG
    profiles: [dev]
  
  # Interactive mode optimizer
  optimizer-interactive:
    build: .
    image: ev-optimizer:latest
    container_name: ev-optimizer-interactive
    command: ["--interactive"]
    stdin_open: true
    tty: true
    env_file:
      - .env
    volumes:
      - ./data_cache:/app/data_cache
      - ./results:/app/results
      - ./logs:/app/logs
    environment:
      - LOG_LEVEL=INFO
    profiles: [interactive, all]
